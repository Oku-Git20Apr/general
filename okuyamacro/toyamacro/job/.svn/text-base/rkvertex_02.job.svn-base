#!/bin/csh

  set period = 2017_04

  set user_name = `whoami`
  set base_dir  = `pwd`/../../..

 #foreach run (10127 10128 10129 10130 10131 10132 10133 10134 \
 #             10135 10136 10137 10138 10141 10142 10143 10144 \
 #             10146 10147 10149 10150 10151 10152 10153 10154 \
 #             10155 10156 10157 10158 10159 10160 10162 10164 \
 #             10167 10168 10169 10170 10171 10175 10176 10177 \
 #             10178 10179 10180 10181 10182 10184 10185 10186 \
 #             10187 10188 10189 10191 10193 10194 10195 10196 \
 #             10197 10198 10199 10200 10201 10202 10203 10205 \
 #             10206 10207 10209 10210 10211 10212 10213 10214 \
 #             10215 10216 10217 10218 10225 10226 10227 10228 \
 #             10229 10230 10232 10233 10234 10236 10237 10238 \
 #             10239 10240 10241 10242 10243 10245             )
#  foreach run (10246 10247 10248 10249 10250 10251 10252 10253 10254 10255 10256 10257 \
#               10258 10259 10261 10262 10268 10269 10270 10271 10272 10273 10274 10275 10276\
#               10277 10278 10280 10282 10283 10284 10286 10287 10288 10289 10290 10291 10292)
#foreach run (10226 \
#             10227 10228 10229 10230 10232 10233 10234 10236 10237 10238 \
#             10293 10294 \
#)
#foreach run ( \
#             10296 10297 10298 10304 10305 10307 10308 10309 10309 10310 \
#             10311 10312 10313 10314 10315 10316 10317 10318 10320 10321 \
#             10322 10323 10324 10324 10325 10326 10327 10342 10345 10346 \
#             10347 10348 10350 )
#foreach run (10246 )
#foreach run ( \
#             10240 10241 10242 10243 10245 \
#              10226 \
#)
#foreach run (10246 10257 10270 10282 10294 10310 10321)
#             10227 10228 10229 10230 10232 10233 10234 10236 10237 10238 \
#             10239 10240 10241 10242 10243 10245 \
#             10246 10247 10248 10249 10250 10251 10252 10253 10254 10255 10256 10257 \
#             10258 10259 10261 10262 10268 10269 10270 10271 10272 10273 10274 10275 10276\
#             10277 10278 10280 10282 10283 10284 10286 10287 10288 10289 10290 10291 10292\
#             10293 10294 \
#             10296 10297 10298 10304 10305 10307 10308 10309 10309 10310 \
#             10311 10312 10313 10314 10315 10316 10317 10318 10320 10321 \
#             10322 10323 10324 10324 10325 10326 10327 10342 10345 10346 \
#             10347 10348 10350 )

##group1##st10226 
##group2##st10238 
#foreach run (10227 10228 \
#             10229 10230 10232 10233 \
#             10234 10236 10237 10239 10240 10241 \
#             10242 10243 10245 )

##group2##st10238 
#foreach run (10239 10240 10241 \
#             10242 10243 10245  )

##group3##st10246 
#foreach run (10246 10247 10248 10249 \
#             10250 10251 10252 10253 \
#             10254 10255 10256 10258 10259 10261  \
#             10262 10268 10269)

##group4##st10257 
#foreach run (10258 10259 10261  \
#             10262 10268 10269  )

##group5##st10270 
#foreach run (10257 10270 10271 10272 10273  \
#             10274 10275 10276 10277  \
#             10278 10280  )

##group6##st10282 
#foreach run (10283 10284 10286  \
#             10287 10288 10289 10290  \
#             10291 10292 10293 )

##group7##st10294 
#foreach run (10296 10297 10298  \
#             10304 10305 10307 10308  \
#             10309  )

##group8##st10310 
#foreach run (10311 10312 10313  \
#             10314 10315 10316 10317  \
#             10318 10320  )

##group9##st10321 
#foreach run (10321 10322 10323 10324  \
#             10325 10326 10342 10345  \
#             10346 10347 10348 10350  )

##foreach run (10304 10305 10307 10308 10309)
####OHH param tune
#foreach run (10247 10248 10249 10250 10251 10252)
#foreach run (10246 10247 10248 10249 )
#foreach run (10282 10283 10284 10286  \
#             10287 10288 10289 10290  \
#             10291 10292 10293 10294 10296 10297 10298  \
#             10304 10305 10307 10308  \
#             10309 10310\
#             10311 10312 10313  \
#             10314 10315 10316 10317  \
#             10318 10320 )
#foreach run (10246 10248)
#foreach run (10226 10227 10228 \
#             10229 10230 10232 10233 \
#             10234 10236 10237 10239 10240 10241 \
#             10242 10243 10245 )
foreach run (10233 10253 10276 10305 10311 10317 10324)

    set root_dir = ${base_dir}/job/root/RKVertex/${run}
    set root_file_base =  RKVertex_${period}_${run} 

    set nfile = `ls ${root_dir} | grep ${root_file_base} | wc | awk '{print $1}'`
#   echo ${nfile}
####   combine each 20 files   ####
    @ nsub = ${nfile} - 1
    @ nsub = ${nsub} / 20 

    set i_count = 0

    while ( ${i_count} <= ${nsub} )

      @ i_first = ${i_count} * 20
      @ i_first = ${i_first} + 1

      if ( ${i_count} == ${nsub} ) then
        @ i_end   = ${nfile}
      else
        @ i_end   = ${i_first} + 19
      endif


cat << EOF >! .rkvertex_02.input
Universe     = vanilla
Initialdir   = ${base_dir}/macros/toyamacro/job
Executable   = ${base_dir}/macros/toyamacro/csh/rkvertex_02.csh
Arguments    = ${root_dir} ${root_file_base} ${i_first} ${i_end}
+MachineList0 = Machine != "farm14.npex.prv"
+MachineList1 = Machine != "farm30.npex.prv"
+MachineList2 = Machine != "farm31.npex.prv"
+MachineList3 = Machine != "farm2.npex.prv"
+MachineList5 = Machine != "farm3.npex.prv"
+MachineList4 = Machine != "farm5.npex.prv"
+MachineList6 = Machine != "farm6.npex.prv"
+MachineList7 = Machine != "farm9.npex.prv"
+MachineList8 = Machine != "farm12.npex.prv"
+MachineList9 = Machine != "farm4.npex.prv"
+MachineList10= Machine != "farm13.npex.prv"
+MachineList11= Machine != "farm10.npex.prv"
+MachineList  = MachineList0 && MachineList1 && MachineList2 && MachineList3 && MachineList4 && MachineList5 && MachineList6 && MachineList7 && MachineList8 && MachineList9 && MachineList10 && MachineList11
Requirements = MachineList && ( Arch == "X86_64" ) && (OpSys == "LINUX") && ( Memory > 500 )
Priority     = -1
getenv       = True
notification = Error
notify_user  = ${user_name}@lambda.phys.tohoku.ac.jp
Queue
EOF

#      echo ${root_dir} ${root_file_base} ${i_first} ${i_end}
      condor_submit .rkvertex_02.input

      @ i_count++

    end

  end


